<!DOCTYPE html>
<html>
 	<head>
 		<title>JsBattle example 猜拳</title>
 		<script type="text/javascript" src="../jsbattle.js"></script>
 		<script type="text/javascript">
 			function $(id){return document.getElementById(id);}
 			var workers=[];
 			window.onload = function(){
 				$('addAIBtn').addEventListener('click',onAddClicked,false);
 				$('toggleRunState').addEventListener('click',onToggleClicked,false);
 				JsBattle.onReady = function(){
 					JsBattle.onMessage = function(evt){
 						console.info("【main thread】got message from worker",JSON.stringify(evt.data));
 					}
 					console.info("all ready");
 					//setTimeout(function(){
 						workers.forEach(function(item){
 							item.postMessage({'cmd':'foundTank','data':'bala bala'});
 							//item.terminate();
 						})
 					//},1000);
 				}
 				JsBattle.addImports("../test.js");
 			}

 			var isRunning = false;
 			function onToggleClicked (event) {
 				if(isRunning){
 					event.target.innerHTML = "start";
 					JsBattle.removeAll();
 					workers = [];
 				}else{
 					event.target.innerHTML = "stop";
 					var inputs = $('editors').querySelectorAll("textarea");
 					for(var i=0;i<inputs.length;++i){
 						var ta = inputs[i];
 						var s = ta.value;
 						var w = JsBattle.addWorker(s);
 						workers.push(w);
 					}
 				}
 				isRunning = !isRunning;
 			}
 			function onAddClicked (event) {
 				var ta = document.createElement('textarea');
 				ta.setAttribute('class','userCodeInput');
 				ta.placeholder = 'code here';
 				$('editors').appendChild(ta);
 			}
 		</script>
 		<style type="text/css">
 			.userCodeInput{
 				width:200px;
 				height:200px;
 				float:left;
 			}
 		</style>
 	</head>
 	<body>
 		<div id="output"></div>
 		<div id="input">
 			<div>
 				<button id="addAIBtn">add worker</button>
 				<button id="toggleRunState">start</button>
 			</div>
 			<div id="editors">
 				<textarea class="userCodeInput" placeholder="code here">
CodeTank.prototype.onFoundTank = function(d){
  log('my found tank',d);
}	
CodeTank.prototype.test = function(){
log("test...");
} 				
 				</textarea>
 				<textarea class="userCodeInput" placeholder="code here">
// onmessage,self,postMessage is all forbidden;
onmessage=function(){log("a.....")};
postMessage('cause error');
self.addEventListener('message',function(){console.info("this never work")});
 				</textarea>
 				<textarea class="userCodeInput">
/*
while(true){
	var s=[];// to force browser NOT to optimize the 'for' below 
	for(var i=0;i &lt; 9999;++i)
	 	for(var j=0;j &lt; 1999;++j)s.push(i*j);
	 log("finished caculate,begining next caculate");
}
*/
 				</textarea>
 			</div>
 		</div>
 <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34554952-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
 	</body>
 </html>